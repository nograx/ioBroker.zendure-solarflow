{
  "version": 3,
  "sources": ["../../../src/models/deviceModels/Hyper2000.ts"],
  "sourcesContent": ["import { hyperControlStates } from \"../../constants/hyperControlStates\";\r\nimport { hyperStates } from \"../../constants/hyperStates\";\r\nimport { ZendureSolarflow } from \"../../main\";\r\nimport { IDeviceAutomationPayload } from \"../IDeviceAutomationPayload\";\r\nimport { IZenHaDeviceDetails } from \"../IZenHaDeviceDetails\";\r\nimport { ZenHaDevice } from \"./ZenHaDevice\";\r\n\r\nexport class Hyper2000 extends ZenHaDevice {\r\n  maxInputLimit = -1200;\r\n  maxOutputLimit = 1200;\r\n\r\n  states = hyperStates;\r\n  controlStates = hyperControlStates;\r\n\r\n  public constructor(\r\n    _adapter: ZendureSolarflow,\r\n    _productKey: string,\r\n    _deviceKey: string,\r\n    _productName: string,\r\n    _deviceName: string,\r\n    _zenHaDeviceDetails?: IZenHaDeviceDetails\r\n  ) {\r\n    super(\r\n      _adapter,\r\n      _productKey,\r\n      _deviceKey,\r\n      _productName,\r\n      _deviceName,\r\n      _zenHaDeviceDetails\r\n    );\r\n  }\r\n\r\n  public async setAcMode(acMode: number): Promise<void> {\r\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\r\n      if (acMode >= 0 && acMode <= 3) {\r\n        const setAcMode = { properties: { acMode: acMode } };\r\n        this.adapter.log.debug(`[setAcMode] Set AC mode to ${acMode}!`);\r\n        this.adapter.mqttClient?.publish(\r\n          this.iotTopic,\r\n          JSON.stringify(setAcMode)\r\n        );\r\n      } else {\r\n        this.adapter.log.error(\r\n          `[setAcMode] AC mode must be a value between 0 and 3!`\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  public setAcSwitch(acSwitch: boolean): void {\r\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\r\n      const setAcSwitchContent = {\r\n        properties: { acSwitch: acSwitch ? 1 : 0 },\r\n      };\r\n      this.adapter.log.debug(\r\n        `[setAcSwitch] Set AC Switch for device ${this.deviceKey} to ${acSwitch}!`\r\n      );\r\n      this.adapter.mqttClient?.publish(\r\n        this.iotTopic,\r\n        JSON.stringify(setAcSwitchContent)\r\n      );\r\n    }\r\n  }\r\n\r\n  public async setDeviceAutomationInOutLimit(\r\n    limit: number // can be negative, negative will trigger charging mode\r\n  ): Promise<void> {\r\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\r\n      this.adapter.log.debug(\r\n        `[setDeviceAutomationInOutLimit] Set device Automation limit to ${limit}!`\r\n      );\r\n\r\n      if (limit) {\r\n        limit = Math.round(limit);\r\n      } else {\r\n        limit = 0;\r\n      }\r\n\r\n      if (this.adapter.config.useLowVoltageBlock) {\r\n        const lowVoltageBlockState = await this.adapter.getStateAsync(\r\n          this.productKey + \".\" + this.deviceKey + \".control.lowVoltageBlock\"\r\n        );\r\n        if (\r\n          lowVoltageBlockState &&\r\n          lowVoltageBlockState.val &&\r\n          lowVoltageBlockState.val == true &&\r\n          limit > 0\r\n        ) {\r\n          limit = 0;\r\n        }\r\n\r\n        const fullChargeNeeded = await this.adapter.getStateAsync(\r\n          this.productKey + \".\" + this.deviceKey + \".control.fullChargeNeeded\"\r\n        );\r\n\r\n        if (\r\n          fullChargeNeeded &&\r\n          fullChargeNeeded.val &&\r\n          fullChargeNeeded.val == true &&\r\n          limit > 0\r\n        ) {\r\n          limit = 0;\r\n        }\r\n      }\r\n\r\n      if (limit < 0) {\r\n        // Get input limit, make number positive and the new value negative\r\n        if (limit < this.maxInputLimit) {\r\n          limit = this.maxInputLimit;\r\n        }\r\n      } else {\r\n        if (limit > this.maxOutputLimit) {\r\n          limit = this.maxOutputLimit;\r\n        }\r\n      }\r\n\r\n      this.adapter.msgCounter += 1;\r\n\r\n      const timestamp = new Date();\r\n      timestamp.setMilliseconds(0);\r\n\r\n      let _arguments: IDeviceAutomationPayload[] = [];\r\n\r\n      if (limit < 0) {\r\n        this.adapter.log.debug(\r\n          `[setDeviceAutomationInOutLimit] Using CHARGE variant of HYPER device automation, as device '${this.deviceKey}' detected and limit is negative!`\r\n        );\r\n        // Input / Charge\r\n        _arguments = [\r\n          {\r\n            autoModelProgram: 1,\r\n            autoModelValue: {\r\n              chargingType: 1,\r\n              price: 2,\r\n              chargingPower: -limit,\r\n              prices: [\r\n                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\r\n                1, 1, 1,\r\n              ],\r\n              outPower: 0,\r\n              freq: 0,\r\n            },\r\n            msgType: 1,\r\n            autoModel: 8,\r\n          },\r\n        ];\r\n      } else {\r\n        this.adapter.log.debug(\r\n          `[setDeviceAutomationInOutLimit] Using FEED IN variant of HYPER device automation, as device '${this.productName}' detected and limit is positive!`\r\n        );\r\n        // Output\r\n        _arguments = [\r\n          {\r\n            autoModelProgram: 2,\r\n            autoModelValue: {\r\n              chargingType: 0,\r\n              chargingPower: 0,\r\n              freq: 0,\r\n              outPower: limit,\r\n            },\r\n            msgType: 1,\r\n            autoModel: 8,\r\n          },\r\n        ];\r\n      }\r\n\r\n      const deviceAutomation = {\r\n        arguments: _arguments,\r\n        function: \"deviceAutomation\",\r\n        messageId: this.adapter.msgCounter,\r\n        deviceKey: this.deviceKey,\r\n        timestamp: timestamp.getTime() / 1000,\r\n      };\r\n      this.adapter.mqttClient?.publish(\r\n        this.functionTopic,\r\n        JSON.stringify(deviceAutomation)\r\n      );\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
