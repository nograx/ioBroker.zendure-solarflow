{
  "version": 3,
  "sources": ["../../../src/models/deviceModels/Aio2400.ts"],
  "sourcesContent": ["import { aioControlStates } from \"../../constants/aioControlStates\";\nimport { aioStates } from \"../../constants/aioStates\";\nimport { ZendureSolarflow } from \"../../main\";\nimport { IDeviceAutomationPayload } from \"../IDeviceAutomationPayload\";\nimport { IZenHaDeviceDetails } from \"../IZenHaDeviceDetails\";\nimport { ZenHaDevice } from \"./ZenHaDevice\";\n\nexport class Aio2400 extends ZenHaDevice {\n  maxInputLimit = 0;\n  maxOutputLimit = 1200;\n\n  states = aioStates;\n  controlStates = aioControlStates;\n\n  public constructor(\n    _adapter: ZendureSolarflow,\n    _productKey: string,\n    _deviceKey: string,\n    _productName: string,\n    _deviceName: string,\n    _zenHaDeviceDetails?: IZenHaDeviceDetails\n  ) {\n    super(\n      _adapter,\n      _productKey,\n      _deviceKey,\n      _productName,\n      _deviceName,\n      _zenHaDeviceDetails\n    );\n  }\n\n  public async setDeviceAutomationInOutLimit(\n    limit: number // can be negative, negative will trigger charging mode\n  ): Promise<void> {\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\n      this.adapter.log.debug(\n        `[setDeviceAutomationInOutLimit] Set device Automation limit to ${limit}!`\n      );\n\n      if (limit) {\n        limit = Math.round(limit);\n      } else {\n        limit = 0;\n      }\n\n      if (this.adapter.config.useLowVoltageBlock) {\n        const lowVoltageBlockState = await this.adapter.getStateAsync(\n          this.productKey + \".\" + this.deviceKey + \".control.lowVoltageBlock\"\n        );\n        if (\n          lowVoltageBlockState &&\n          lowVoltageBlockState.val &&\n          lowVoltageBlockState.val == true &&\n          limit > 0\n        ) {\n          limit = 0;\n        }\n\n        const fullChargeNeeded = await this.adapter.getStateAsync(\n          this.productKey + \".\" + this.deviceKey + \".control.fullChargeNeeded\"\n        );\n\n        if (\n          fullChargeNeeded &&\n          fullChargeNeeded.val &&\n          fullChargeNeeded.val == true &&\n          limit > 0\n        ) {\n          limit = 0;\n        }\n      }\n\n      if (limit < 0) {\n        this.adapter.log.debug(\n          `[setDeviceAutomationInOutLimit] AIO 2400 can not charge by AC!`\n        );\n        return;\n      } else {\n        if (limit > this.maxOutputLimit) {\n          limit = this.maxOutputLimit;\n        }\n      }\n\n      if (\n        limit < 100 &&\n        limit != 90 &&\n        limit != 60 &&\n        limit != 30 &&\n        limit != 0\n      ) {\n        // NUR Solarflow HUB: Das Limit kann unter 100 nur in 30er Schritten gesetzt werden, dH. 30/60/90/100, wir rechnen das also um\n        if (limit < 100 && limit > 90) {\n          limit = 90;\n        } else if (limit > 60 && limit < 90) {\n          limit = 60;\n        } else if (limit > 30 && limit < 60) {\n          limit = 30;\n        } else if (limit < 30) {\n          limit = 30;\n        }\n      }\n\n      this.adapter.msgCounter += 1;\n\n      const timestamp = new Date();\n      timestamp.setMilliseconds(0);\n\n      let _arguments: IDeviceAutomationPayload[] = [];\n\n      // Output\n      this.adapter.log.debug(\n        `[setDeviceAutomationInOutLimit] Using FEED IN variant of AIO device automation, as device '${this.productKey}' detected and limit is positive!`\n      );\n      _arguments = [\n        {\n          autoModelProgram: 2,\n          autoModelValue: limit,\n          msgType: 1,\n          autoModel: 8,\n        },\n      ];\n\n      const deviceAutomation = {\n        arguments: _arguments,\n        function: \"deviceAutomation\",\n        messageId: this.adapter.msgCounter,\n        deviceKey: this.deviceKey,\n        timestamp: timestamp.getTime() / 1000,\n      };\n      this.adapter.mqttClient?.publish(\n        this.functionTopic,\n        JSON.stringify(deviceAutomation)\n      );\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAAiC;AACjC,uBAA0B;AAI1B,yBAA4B;AAErB,MAAM,gBAAgB,+BAAY;AAAA,EAOhC,YACL,UACA,aACA,YACA,cACA,aACA,qBACA;AACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AArBF,yBAAgB;AAChB,0BAAiB;AAEjB,kBAAS;AACT,yBAAgB;AAAA,EAkBhB;AAAA,EAEA,MAAa,8BACX,OACe;AAlCnB;AAmCI,QAAI,KAAK,QAAQ,cAAc,KAAK,cAAc,KAAK,WAAW;AAChE,WAAK,QAAQ,IAAI;AAAA,QACf,kEAAkE,KAAK;AAAA,MACzE;AAEA,UAAI,OAAO;AACT,gBAAQ,KAAK,MAAM,KAAK;AAAA,MAC1B,OAAO;AACL,gBAAQ;AAAA,MACV;AAEA,UAAI,KAAK,QAAQ,OAAO,oBAAoB;AAC1C,cAAM,uBAAuB,MAAM,KAAK,QAAQ;AAAA,UAC9C,KAAK,aAAa,MAAM,KAAK,YAAY;AAAA,QAC3C;AACA,YACE,wBACA,qBAAqB,OACrB,qBAAqB,OAAO,QAC5B,QAAQ,GACR;AACA,kBAAQ;AAAA,QACV;AAEA,cAAM,mBAAmB,MAAM,KAAK,QAAQ;AAAA,UAC1C,KAAK,aAAa,MAAM,KAAK,YAAY;AAAA,QAC3C;AAEA,YACE,oBACA,iBAAiB,OACjB,iBAAiB,OAAO,QACxB,QAAQ,GACR;AACA,kBAAQ;AAAA,QACV;AAAA,MACF;AAEA,UAAI,QAAQ,GAAG;AACb,aAAK,QAAQ,IAAI;AAAA,UACf;AAAA,QACF;AACA;AAAA,MACF,OAAO;AACL,YAAI,QAAQ,KAAK,gBAAgB;AAC/B,kBAAQ,KAAK;AAAA,QACf;AAAA,MACF;AAEA,UACE,QAAQ,OACR,SAAS,MACT,SAAS,MACT,SAAS,MACT,SAAS,GACT;AAEA,YAAI,QAAQ,OAAO,QAAQ,IAAI;AAC7B,kBAAQ;AAAA,QACV,WAAW,QAAQ,MAAM,QAAQ,IAAI;AACnC,kBAAQ;AAAA,QACV,WAAW,QAAQ,MAAM,QAAQ,IAAI;AACnC,kBAAQ;AAAA,QACV,WAAW,QAAQ,IAAI;AACrB,kBAAQ;AAAA,QACV;AAAA,MACF;AAEA,WAAK,QAAQ,cAAc;AAE3B,YAAM,YAAY,oBAAI,KAAK;AAC3B,gBAAU,gBAAgB,CAAC;AAE3B,UAAI,aAAyC,CAAC;AAG9C,WAAK,QAAQ,IAAI;AAAA,QACf,8FAA8F,KAAK,UAAU;AAAA,MAC/G;AACA,mBAAa;AAAA,QACX;AAAA,UACE,kBAAkB;AAAA,UAClB,gBAAgB;AAAA,UAChB,SAAS;AAAA,UACT,WAAW;AAAA,QACb;AAAA,MACF;AAEA,YAAM,mBAAmB;AAAA,QACvB,WAAW;AAAA,QACX,UAAU;AAAA,QACV,WAAW,KAAK,QAAQ;AAAA,QACxB,WAAW,KAAK;AAAA,QAChB,WAAW,UAAU,QAAQ,IAAI;AAAA,MACnC;AACA,iBAAK,QAAQ,eAAb,mBAAyB;AAAA,QACvB,KAAK;AAAA,QACL,KAAK,UAAU,gBAAgB;AAAA;AAAA,IAEnC;AAAA,EACF;AACF;",
  "names": []
}
