{
  "version": 3,
  "sources": ["../../../src/models/deviceModels/Ace1500.ts"],
  "sourcesContent": ["import { aceControlStates } from \"../../constants/aceControlStates\";\nimport { aceStates } from \"../../constants/aceStates\";\nimport { ZendureSolarflow } from \"../../main\";\nimport { IDeviceAutomationPayload } from \"../IDeviceAutomationPayload\";\nimport { IZenHaDeviceDetails } from \"../IZenHaDeviceDetails\";\nimport { ZenHaDevice } from \"./ZenHaDevice\";\n\nexport class Ace1500 extends ZenHaDevice {\n  maxInputLimit = 900;\n  maxOutputLimit = 900;\n\n  states = aceStates;\n  controlStates = aceControlStates;\n\n  public constructor(\n    _adapter: ZendureSolarflow,\n    _productKey: string,\n    _deviceKey: string,\n    _productName: string,\n    _deviceName: string,\n    _zenHaDeviceDetails?: IZenHaDeviceDetails\n  ) {\n    super(\n      _adapter,\n      _productKey,\n      _deviceKey,\n      _productName,\n      _deviceName,\n      _zenHaDeviceDetails\n    );\n  }\n\n  public setDcSwitch(dcSwitch: boolean): void {\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\n      const setDcSwitchContent = {\n        properties: { dcSwitch: dcSwitch ? 1 : 0 },\n      };\n      this.adapter.log.debug(\n        `[setDcSwitch] Set DC Switch for device ${this.deviceKey} to ${dcSwitch}!`\n      );\n      this.adapter.mqttClient?.publish(\n        this.iotTopic,\n        JSON.stringify(setDcSwitchContent)\n      );\n    }\n  }\n\n  public setAcSwitch(acSwitch: boolean): void {\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\n      const setAcSwitchContent = {\n        properties: { acSwitch: acSwitch ? 1 : 0 },\n      };\n      this.adapter.log.debug(\n        `[setAcSwitch] Set AC Switch for device ${this.deviceKey} to ${acSwitch}!`\n      );\n      this.adapter.mqttClient?.publish(\n        this.iotTopic,\n        JSON.stringify(setAcSwitchContent)\n      );\n    }\n  }\n\n  public async setDeviceAutomationInOutLimit(\n    limit: number // can be negative, negative will trigger charging mode\n  ): Promise<void> {\n    if (this.adapter.mqttClient && this.productKey && this.deviceKey) {\n      this.adapter.log.debug(\n        `[setDeviceAutomationInOutLimit] Set device Automation limit to ${limit}!`\n      );\n\n      if (limit) {\n        limit = Math.round(limit);\n      } else {\n        limit = 0;\n      }\n\n      if (limit > 0) {\n        this.adapter.log.error(\n          `[setDeviceAutomationInOutLimit] ACE 1500 can not feed in!`\n        );\n      }\n\n      // Convert maxInputLimit to negative value and compare to limit\n      if (limit < 0 && limit < -this.maxInputLimit) {\n        this.adapter.log.debug(\n          `[setDeviceAutomationInOutLimit] limit ${limit} is below the maximum input limit of ${this.maxInputLimit}, setting to ${-this.maxInputLimit}!`\n        );\n        limit = -this.maxInputLimit;\n      }\n\n      this.messageId += 1;\n\n      const timestamp = new Date();\n      timestamp.setMilliseconds(0);\n\n      let _arguments: IDeviceAutomationPayload[] = [];\n\n      if (limit < 0) {\n        this.adapter.log.debug(\n          `[setDeviceAutomationInOutLimit] Using CHARGE variant of ACE 1500 device automation, as device '${this.productKey}' detected and limit (${limit}) is negative!`\n        );\n        _arguments = [\n          {\n            autoModelProgram: 2,\n            autoModelValue: {\n              chargingType: 1,\n              chargingPower: Math.abs(limit),\n              freq: 0,\n              outPower: 0,\n            },\n            msgType: 1,\n            autoModel: 8,\n          },\n        ];\n      }\n\n      const deviceAutomation = {\n        arguments: _arguments,\n        function: \"deviceAutomation\",\n        messageId: this.messageId,\n        deviceKey: this.deviceKey,\n        timestamp: timestamp.getTime() / 1000,\n      };\n      this.adapter.mqttClient?.publish(\n        this.functionTopic,\n        JSON.stringify(deviceAutomation)\n      );\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAAiC;AACjC,uBAA0B;AAI1B,yBAA4B;AAErB,MAAM,gBAAgB,+BAAY;AAAA,EAOhC,YACL,UACA,aACA,YACA,cACA,aACA,qBACA;AACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AArBF,yBAAgB;AAChB,0BAAiB;AAEjB,kBAAS;AACT,yBAAgB;AAAA,EAkBhB;AAAA,EAEO,YAAY,UAAyB;AAhC9C;AAiCI,QAAI,KAAK,QAAQ,cAAc,KAAK,cAAc,KAAK,WAAW;AAChE,YAAM,qBAAqB;AAAA,QACzB,YAAY,EAAE,UAAU,WAAW,IAAI,EAAE;AAAA,MAC3C;AACA,WAAK,QAAQ,IAAI;AAAA,QACf,0CAA0C,KAAK,SAAS,OAAO,QAAQ;AAAA,MACzE;AACA,iBAAK,QAAQ,eAAb,mBAAyB;AAAA,QACvB,KAAK;AAAA,QACL,KAAK,UAAU,kBAAkB;AAAA;AAAA,IAErC;AAAA,EACF;AAAA,EAEO,YAAY,UAAyB;AA/C9C;AAgDI,QAAI,KAAK,QAAQ,cAAc,KAAK,cAAc,KAAK,WAAW;AAChE,YAAM,qBAAqB;AAAA,QACzB,YAAY,EAAE,UAAU,WAAW,IAAI,EAAE;AAAA,MAC3C;AACA,WAAK,QAAQ,IAAI;AAAA,QACf,0CAA0C,KAAK,SAAS,OAAO,QAAQ;AAAA,MACzE;AACA,iBAAK,QAAQ,eAAb,mBAAyB;AAAA,QACvB,KAAK;AAAA,QACL,KAAK,UAAU,kBAAkB;AAAA;AAAA,IAErC;AAAA,EACF;AAAA,EAEA,MAAa,8BACX,OACe;AAhEnB;AAiEI,QAAI,KAAK,QAAQ,cAAc,KAAK,cAAc,KAAK,WAAW;AAChE,WAAK,QAAQ,IAAI;AAAA,QACf,kEAAkE,KAAK;AAAA,MACzE;AAEA,UAAI,OAAO;AACT,gBAAQ,KAAK,MAAM,KAAK;AAAA,MAC1B,OAAO;AACL,gBAAQ;AAAA,MACV;AAEA,UAAI,QAAQ,GAAG;AACb,aAAK,QAAQ,IAAI;AAAA,UACf;AAAA,QACF;AAAA,MACF;AAGA,UAAI,QAAQ,KAAK,QAAQ,CAAC,KAAK,eAAe;AAC5C,aAAK,QAAQ,IAAI;AAAA,UACf,yCAAyC,KAAK,wCAAwC,KAAK,aAAa,gBAAgB,CAAC,KAAK,aAAa;AAAA,QAC7I;AACA,gBAAQ,CAAC,KAAK;AAAA,MAChB;AAEA,WAAK,aAAa;AAElB,YAAM,YAAY,oBAAI,KAAK;AAC3B,gBAAU,gBAAgB,CAAC;AAE3B,UAAI,aAAyC,CAAC;AAE9C,UAAI,QAAQ,GAAG;AACb,aAAK,QAAQ,IAAI;AAAA,UACf,kGAAkG,KAAK,UAAU,yBAAyB,KAAK;AAAA,QACjJ;AACA,qBAAa;AAAA,UACX;AAAA,YACE,kBAAkB;AAAA,YAClB,gBAAgB;AAAA,cACd,cAAc;AAAA,cACd,eAAe,KAAK,IAAI,KAAK;AAAA,cAC7B,MAAM;AAAA,cACN,UAAU;AAAA,YACZ;AAAA,YACA,SAAS;AAAA,YACT,WAAW;AAAA,UACb;AAAA,QACF;AAAA,MACF;AAEA,YAAM,mBAAmB;AAAA,QACvB,WAAW;AAAA,QACX,UAAU;AAAA,QACV,WAAW,KAAK;AAAA,QAChB,WAAW,KAAK;AAAA,QAChB,WAAW,UAAU,QAAQ,IAAI;AAAA,MACnC;AACA,iBAAK,QAAQ,eAAb,mBAAyB;AAAA,QACvB,KAAK;AAAA,QACL,KAAK,UAAU,gBAAgB;AAAA;AAAA,IAEnC;AAAA,EACF;AACF;",
  "names": []
}
