{
  "version": 3,
  "sources": ["../../src/services/mqttLocalService.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/indent */\nimport mqtt from \"mqtt\";\nimport { ZendureSolarflow } from \"../main\";\nimport {\n  adapter,\n  initAdapter,\n  onConnected,\n  onError,\n  onMessage,\n} from \"./mqttSharedService\";\nimport {\n  startCalculationJob,\n  startCheckStatesAndConnectionJob,\n  startResetValuesJob,\n} from \"./jobSchedule\";\n\nexport const connectLocalMqttClient = (_adapter: ZendureSolarflow): void => {\n  initAdapter(_adapter);\n\n  if (!adapter) {\n    return;\n  }\n\n  const options: mqtt.IClientOptions = {\n    clientId: \"ioBroker.zendure-solarflow.\" + adapter.instance,\n  };\n\n  if (mqtt && adapter && adapter.config && adapter.config.localMqttUrl) {\n    adapter.log.debug(\n      `[connectLocalMqttClient] Connecting to MQTT broker ${\n        adapter.config.localMqttUrl + \":\" + 1883\n      }...`\n    );\n    adapter.mqttClient = mqtt.connect(\n      \"mqtt://\" + adapter.config.localMqttUrl + \":\" + 1883,\n      options\n    ); // create a client\n\n    if (adapter && adapter.mqttClient) {\n      adapter.mqttClient.on(\"connect\", onConnected);\n      adapter.mqttClient.on(\"error\", onError);\n\n      adapter.setState(\"info.connection\", true, true);\n\n      adapter.mqttClient.on(\"message\", onMessage);\n\n      // Job starten die states in der Nacht zu resetten\n      startResetValuesJob(adapter);\n\n      // Job starten die States zu checken\n      startCheckStatesAndConnectionJob(adapter);\n\n      // Calculation Job starten sofern aktiviert\n      if (adapter.config.useCalculation) {\n        startCalculationJob(adapter);\n      }\n    }\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,kBAAiB;AAEjB,+BAMO;AACP,yBAIO;AAEA,MAAM,yBAAyB,CAAC,aAAqC;AAC1E,4CAAY,QAAQ;AAEpB,MAAI,CAAC,kCAAS;AACZ;AAAA,EACF;AAEA,QAAM,UAA+B;AAAA,IACnC,UAAU,gCAAgC,iCAAQ;AAAA,EACpD;AAEA,MAAI,YAAAA,WAAQ,oCAAW,iCAAQ,UAAU,iCAAQ,OAAO,cAAc;AACpE,qCAAQ,IAAI;AAAA,MACV,sDACE,iCAAQ,OAAO,eAAe,OAChC;AAAA,IACF;AACA,qCAAQ,aAAa,YAAAA,QAAK;AAAA,MACxB,YAAY,iCAAQ,OAAO,eAAe;AAAA,MAC1C;AAAA,IACF;AAEA,QAAI,oCAAW,iCAAQ,YAAY;AACjC,uCAAQ,WAAW,GAAG,WAAW,oCAAW;AAC5C,uCAAQ,WAAW,GAAG,SAAS,gCAAO;AAEtC,uCAAQ,SAAS,mBAAmB,MAAM,IAAI;AAE9C,uCAAQ,WAAW,GAAG,WAAW,kCAAS;AAG1C,kDAAoB,gCAAO;AAG3B,+DAAiC,gCAAO;AAGxC,UAAI,iCAAQ,OAAO,gBAAgB;AACjC,oDAAoB,gCAAO;AAAA,MAC7B;AAAA,IACF;AAAA,EACF;AACF;",
  "names": ["mqtt"]
}
