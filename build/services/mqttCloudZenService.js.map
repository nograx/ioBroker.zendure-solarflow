{
  "version": 3,
  "sources": ["../../src/services/mqttCloudZenService.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/indent */\n\nimport mqtt from \"mqtt\";\nimport { ZendureSolarflow } from \"../main\";\nimport {\n  adapter,\n  initAdapter,\n  onConnected,\n  onError,\n  onMessage,\n} from \"./mqttSharedService\";\nimport {\n  startCalculationJob,\n  startCheckStatesAndConnectionJob,\n  startResetValuesJob,\n} from \"./jobSchedule\";\n\nexport const connectCloudZenMqttClient = (\n  _adapter: ZendureSolarflow\n): boolean => {\n  if (!_adapter) {\n    return false;\n  }\n\n  initAdapter(_adapter);\n\n  if (!adapter || !adapter.mqttSettings) {\n    _adapter.log.error(`[connectCloudMqttClient] MQTT settings missing!`);\n    return false;\n  }\n\n  const options: mqtt.IClientOptions = {\n    clientId: adapter.mqttSettings.clientId,\n    username: adapter.mqttSettings.username,\n    password: adapter.mqttSettings.password,\n    clean: true,\n    protocolVersion: 5,\n  };\n\n  if (mqtt && adapter && adapter.mqttSettings) {\n    adapter.log.debug(\n      `[connectCloudMqttClient] Connecting to MQTT broker ${\n        adapter.mqttSettings.url + \":1883\"\n      }...`\n    );\n    adapter.mqttClient = mqtt.connect(\n      \"mqtt://\" + adapter.mqttSettings.url + \":1883\",\n      options\n    ); // create a client\n\n    if (adapter && adapter.mqttClient) {\n      adapter.mqttClient.on(\"connect\", onConnected);\n      adapter.mqttClient.on(\"error\", onError);\n\n      adapter.mqttClient.on(\"message\", onMessage);\n\n      // Job starten die states in der Nacht zu resetten\n      startResetValuesJob(adapter);\n\n      // Job starten die States zu checken\n      startCheckStatesAndConnectionJob(adapter);\n\n      // Calculation Job starten sofern aktiviert\n      if (adapter.config.useCalculation) {\n        startCalculationJob(adapter);\n      }\n\n      return true;\n    }\n  }\n\n  return false;\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,kBAAiB;AAEjB,+BAMO;AACP,yBAIO;AAEA,MAAM,4BAA4B,CACvC,aACY;AACZ,MAAI,CAAC,UAAU;AACb,WAAO;AAAA,EACT;AAEA,4CAAY,QAAQ;AAEpB,MAAI,CAAC,oCAAW,CAAC,iCAAQ,cAAc;AACrC,aAAS,IAAI,MAAM,iDAAiD;AACpE,WAAO;AAAA,EACT;AAEA,QAAM,UAA+B;AAAA,IACnC,UAAU,iCAAQ,aAAa;AAAA,IAC/B,UAAU,iCAAQ,aAAa;AAAA,IAC/B,UAAU,iCAAQ,aAAa;AAAA,IAC/B,OAAO;AAAA,IACP,iBAAiB;AAAA,EACnB;AAEA,MAAI,YAAAA,WAAQ,oCAAW,iCAAQ,cAAc;AAC3C,qCAAQ,IAAI;AAAA,MACV,sDACE,iCAAQ,aAAa,MAAM,OAC7B;AAAA,IACF;AACA,qCAAQ,aAAa,YAAAA,QAAK;AAAA,MACxB,YAAY,iCAAQ,aAAa,MAAM;AAAA,MACvC;AAAA,IACF;AAEA,QAAI,oCAAW,iCAAQ,YAAY;AACjC,uCAAQ,WAAW,GAAG,WAAW,oCAAW;AAC5C,uCAAQ,WAAW,GAAG,SAAS,gCAAO;AAEtC,uCAAQ,WAAW,GAAG,WAAW,kCAAS;AAG1C,kDAAoB,gCAAO;AAG3B,+DAAiC,gCAAO;AAGxC,UAAI,iCAAQ,OAAO,gBAAgB;AACjC,oDAAoB,gCAAO;AAAA,MAC7B;AAEA,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO;AACT;",
  "names": ["mqtt"]
}
