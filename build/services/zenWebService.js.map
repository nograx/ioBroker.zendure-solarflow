{
  "version": 3,
  "sources": ["../../src/services/zenWebService.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/indent */\nimport axios, { AxiosRequestConfig } from \"axios\";\nimport { haKey } from \"../constants/constants\";\nimport { ZendureSolarflow } from \"../main\";\nimport * as crypto from \"crypto\";\nimport { IHaDeviceListData } from \"../models/IHaDeviceListData\";\n\nexport const zenLogin = async (\n  adapter: ZendureSolarflow\n): Promise<string | IHaDeviceListData | undefined> => {\n  const decodedAuthCloudKey = Buffer.from(\n    adapter.config.authorizationCloudKey,\n    \"base64\"\n  ).toString(\"utf-8\");\n\n  const lastDot = decodedAuthCloudKey.lastIndexOf(\".\");\n  if (lastDot === -1) {\n    // Invalid\n  }\n\n  const apiUrl = decodedAuthCloudKey.slice(0, lastDot);\n  const appKey = decodedAuthCloudKey.slice(lastDot + 1);\n\n  const body = {\n    appKey: appKey,\n  };\n\n  // Timestamp und Nonce\n  const timestamp = Math.floor(Date.now() / 1000);\n  const nonce = (Math.floor(Math.random() * 90000) + 10000).toString();\n\n  // Signatur-Parameter\n  const signParams: Record<string, string | number> = {\n    ...body,\n    timestamp: timestamp,\n    nonce: nonce,\n  };\n\n  // Signatur-String erstellen\n  const bodyStr = Object.keys(signParams)\n    .sort()\n    .map((k) => `${k}${signParams[k]}`)\n    .join(\"\");\n\n  const signStr = `${haKey}${bodyStr}${haKey}`;\n\n  // SHA1-Hash berechnen\n  const sha1 = crypto.createHash(\"sha1\");\n  sha1.update(signStr, \"utf8\");\n  const sign = sha1.digest(\"hex\").toUpperCase();\n\n  // Header bauen\n  const headers = {\n    \"Content-Type\": \"application/json\",\n    timestamp: timestamp.toString(),\n    nonce: nonce,\n    clientid: \"zenHa\",\n    sign: sign,\n  };\n\n  const config: AxiosRequestConfig = {\n    headers: headers,\n    timeout: 10000,\n  };\n\n  // Request\n  return axios\n    .post(`${apiUrl}/api/ha/deviceList`, JSON.stringify(body), config)\n    .then(async function (response) {\n      const data = await response.data;\n\n      return data.data;\n    })\n    .catch(async function (error) {\n      if (error.response) {\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        adapter.log.error(error.response.data);\n        adapter.log.error(error.response.status);\n        adapter.log.error(error.response.headers);\n      } else if (error.request) {\n        // The request was made but no response was received\n        // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n        // http.ClientRequest in node.js\n        adapter.log.error(error.request);\n      } else {\n        // Something happened in setting up the request that triggered an Error\n        adapter.log.error(\"Error\" + error.message);\n      }\n      adapter.log.error(error.config);\n    });\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,mBAA0C;AAC1C,uBAAsB;AAEtB,aAAwB;AAGjB,MAAM,WAAW,OACtB,YACoD;AACpD,QAAM,sBAAsB,OAAO;AAAA,IACjC,QAAQ,OAAO;AAAA,IACf;AAAA,EACF,EAAE,SAAS,OAAO;AAElB,QAAM,UAAU,oBAAoB,YAAY,GAAG;AACnD,MAAI,YAAY,IAAI;AAAA,EAEpB;AAEA,QAAM,SAAS,oBAAoB,MAAM,GAAG,OAAO;AACnD,QAAM,SAAS,oBAAoB,MAAM,UAAU,CAAC;AAEpD,QAAM,OAAO;AAAA,IACX;AAAA,EACF;AAGA,QAAM,YAAY,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AAC9C,QAAM,SAAS,KAAK,MAAM,KAAK,OAAO,IAAI,GAAK,IAAI,KAAO,SAAS;AAGnE,QAAM,aAA8C;AAAA,IAClD,GAAG;AAAA,IACH;AAAA,IACA;AAAA,EACF;AAGA,QAAM,UAAU,OAAO,KAAK,UAAU,EACnC,KAAK,EACL,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,WAAW,CAAC,CAAC,EAAE,EACjC,KAAK,EAAE;AAEV,QAAM,UAAU,GAAG,sBAAK,GAAG,OAAO,GAAG,sBAAK;AAG1C,QAAM,OAAO,OAAO,WAAW,MAAM;AACrC,OAAK,OAAO,SAAS,MAAM;AAC3B,QAAM,OAAO,KAAK,OAAO,KAAK,EAAE,YAAY;AAG5C,QAAM,UAAU;AAAA,IACd,gBAAgB;AAAA,IAChB,WAAW,UAAU,SAAS;AAAA,IAC9B;AAAA,IACA,UAAU;AAAA,IACV;AAAA,EACF;AAEA,QAAM,SAA6B;AAAA,IACjC;AAAA,IACA,SAAS;AAAA,EACX;AAGA,SAAO,aAAAA,QACJ,KAAK,GAAG,MAAM,sBAAsB,KAAK,UAAU,IAAI,GAAG,MAAM,EAChE,KAAK,eAAgB,UAAU;AAC9B,UAAM,OAAO,MAAM,SAAS;AAE5B,WAAO,KAAK;AAAA,EACd,CAAC,EACA,MAAM,eAAgB,OAAO;AAC5B,QAAI,MAAM,UAAU;AAGlB,cAAQ,IAAI,MAAM,MAAM,SAAS,IAAI;AACrC,cAAQ,IAAI,MAAM,MAAM,SAAS,MAAM;AACvC,cAAQ,IAAI,MAAM,MAAM,SAAS,OAAO;AAAA,IAC1C,WAAW,MAAM,SAAS;AAIxB,cAAQ,IAAI,MAAM,MAAM,OAAO;AAAA,IACjC,OAAO;AAEL,cAAQ,IAAI,MAAM,UAAU,MAAM,OAAO;AAAA,IAC3C;AACA,YAAQ,IAAI,MAAM,MAAM,MAAM;AAAA,EAChC,CAAC;AACL;",
  "names": ["axios"]
}
